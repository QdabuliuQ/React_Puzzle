{"version":3,"file":"static/js/653.e16e3329.chunk.js","mappings":"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","sources":["pages/GamePage/components/Puzzle/Puzzle.jsx","pages/GamePage/GamePage.jsx"],"sourcesContent":["import React, { Component } from 'react'\r\nimport { SpinLoading, Toast } from 'antd-mobile'\r\nimport PubSub from 'pubsub-js'\r\nimport download from \"utils/download\";\r\nimport { getRandomImage } from \"network/index\";\r\nimport PuzzleItem from \"components/PuzzleItem/PuzzleItem\";\r\nimport \"./Puzzle.less\"\r\n\r\nlet token1;\r\nlet token2;\r\nlet token3;\r\nlet token4;\r\nexport default class Puzzle extends Component {\r\n  state = {\r\n    isLoad: true,\r\n    imageUrl: '', // 图片url\r\n    mode: 3,  // 3*3\r\n    imageList: [],  // 小图片数组\r\n    randomList: [],  // 小图片乱序\r\n    itemWidth: 0,\r\n    gap: 5,  // 图片间隙\r\n    containWidth: 0,  // 拼图容器的宽度\r\n    activeIndex: -1,  // 被点击的拼图\r\n  }\r\n\r\n  // 切割图片\r\n  computedCanvas = (image, size) => {\r\n    let tempList = []\r\n    let width = size / this.state.mode\r\n    let k = 1\r\n    for (let j = 0; j < this.state.mode; j++) {\r\n      for (let i = 0; i < this.state.mode; i++) {\r\n        const canvas = document.createElement('canvas')\r\n        const ctx = canvas.getContext('2d')\r\n        canvas.width = width\r\n        canvas.height = width\r\n        canvas.style.width = '100%'\r\n        ctx.drawImage(image, i * width, j * width, width, width, 0, 0, width, width)\r\n        tempList.push({\r\n          ...this.computedAxis(k - 1, 'x', 'y'),\r\n          index: k,\r\n          base64: canvas.toDataURL(\"image/png\")\r\n        })\r\n        k++\r\n      }\r\n    }\r\n    this.setState({\r\n      imageList: tempList\r\n    }, () => {\r\n      this.randomList()\r\n    })\r\n  }\r\n\r\n  // 获取图片url\r\n  getImageUrl = () => {\r\n    getRandomImage().then(res => {\r\n      this.state.imageUrl = res.replace('https://tuapi.eees.cc', '/api1')\r\n      const image = new Image()\r\n      image.src = this.state.imageUrl\r\n      image.crossOrigin = '';\r\n      image.onload = () => {\r\n        let size = image.width > image.height ? image.height : image.width\r\n        this.computedCanvas(image, size)\r\n      }\r\n    })\r\n  }\r\n\r\n  // 打乱数组元素\r\n  randomList = () => {\r\n    let temp = [...this.state.imageList]\r\n    temp.sort((item) => {\r\n      return Math.random() - 0.5\r\n    })\r\n    for (let i = 0; i < temp.length; i++) {\r\n      temp[i] = Object.assign(temp[i],this.computedAxis(i));\r\n    }\r\n    this.setState({\r\n      randomList: temp,\r\n      isLoad: false\r\n    })\r\n  }\r\n\r\n  // 计算坐标\r\n  computedAxis = (index, propertyName_x = 'left', propertyName_y = 'top') => {\r\n    let left;\r\n    let top;\r\n    if (index == 0) {\r\n      left = index % this.state.mode * this.state.itemWidth + 'px'\r\n      top = Math.floor(index / this.state.mode) * this.state.itemWidth + 'px'\r\n    } else if (index != 0 && index < this.state.mode) {\r\n      left = index % this.state.mode * this.state.itemWidth + (this.state.gap * (index % this.state.mode)) + 'px'\r\n      top = Math.floor(index / this.state.mode) * this.state.itemWidth + 'px'\r\n    } else if (index % this.state.mode == 0) {\r\n      left = index % this.state.mode * this.state.itemWidth + 'px'\r\n      top = Math.floor(index / this.state.mode) * this.state.itemWidth + (this.state.gap * Math.floor(index / this.state.mode)) + 'px'\r\n    } else {\r\n      left = index % this.state.mode * this.state.itemWidth + (this.state.gap * (index % this.state.mode)) + 'px'\r\n      top = Math.floor(index / this.state.mode) * this.state.itemWidth + (this.state.gap * Math.floor(index / this.state.mode)) + 'px'\r\n    }\r\n    return {\r\n      [propertyName_x]: left,\r\n      [propertyName_y]: top\r\n    }\r\n  }\r\n\r\n  // 拼图点击\r\n  puzzleItemClick = (e) => {\r\n    if (e == this.state.activeIndex) {\r\n      this.setState({\r\n        activeIndex: -1,\r\n      })\r\n    } else if (this.state.activeIndex == -1) {\r\n      this.setState({\r\n        activeIndex: e,\r\n      })\r\n    } else {  // 交换拼图位置\r\n      // 获取 activeIndex 上一个点击的拼图索引\r\n      let temp = JSON.parse(JSON.stringify(this.state.randomList))\r\n      let e_left = temp[e].left\r\n      let e_top = temp[e].top\r\n      temp[e].left = temp[this.state.activeIndex].left\r\n      temp[e].top = temp[this.state.activeIndex].top\r\n      temp[this.state.activeIndex].left = e_left\r\n      temp[this.state.activeIndex].top = e_top\r\n      this.setState({\r\n        activeIndex: -1,\r\n        randomList: temp\r\n      })\r\n      this.checkPuzzle(temp)\r\n    }\r\n  }\r\n\r\n  checkPuzzle = (arr) => {\r\n    for (let i = 1; i < arr.length; i++) {\r\n      if ((arr[i].left != arr[i].x) || (arr[i].top != arr[i].y)) {\r\n        return\r\n      }\r\n    }\r\n    PubSub.publish('success')\r\n  }\r\n\r\n  componentDidMount() {\r\n    let width = (document.documentElement.clientWidth - 30) / this.state.mode\r\n    this.setState({\r\n      itemWidth: width,\r\n      containWidth: width * this.state.mode + ((this.state.mode - 1) * this.state.gap)\r\n    })\r\n    this.getImageUrl()\r\n    \r\n    // 替换图片\r\n    token1 = PubSub.subscribe('replace', () => {\r\n      this.setState({\r\n        isLoad: true\r\n      }, () => {\r\n        this.getImageUrl()\r\n      })\r\n    })  \r\n    \r\n    // 保存图片\r\n    token2 = PubSub.subscribe('save', () => {\r\n      download(this.state.imageUrl, 'image')\r\n    })\r\n\r\n    // 重新排序图片\r\n    token3 = PubSub.subscribe('rank', () => {\r\n      this.setState({\r\n        isLoad: true\r\n      }, () => {\r\n        this.randomList()\r\n      })  \r\n    })\r\n\r\n    // 模式切换\r\n    token4 = PubSub.subscribe('modeChange', (msg, e) => {\r\n      this.setState({\r\n        isLoad: true,\r\n        itemWidth: (this.state.containWidth - (e - 1) * this.state.gap) / e,\r\n        mode: e\r\n      }, () => {\r\n        const image = new Image()\r\n        image.src = this.state.imageUrl\r\n        image.crossOrigin = '';\r\n        image.onload = () => {\r\n          let size = image.width > image.height ? image.height : image.width\r\n          this.computedCanvas(image, size)\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    PubSub.unsubscribe(token1)\r\n    PubSub.unsubscribe(token2)\r\n    PubSub.unsubscribe(token3)\r\n    PubSub.unsubscribe(token4)\r\n  }\r\n\r\n  render() {\r\n    const { isLoad, randomList, itemWidth, containWidth, activeIndex, imageList } = this.state\r\n    return (\r\n      <div id='Puzzle'>\r\n        <div style={{ width: containWidth + 'px' }} className='puzzleContainer'>\r\n          {\r\n            isLoad && (\r\n              <div className='loadMask'>\r\n                <SpinLoading style={{'--color': '#eaad30', '--size': '100px' }} />\r\n              </div>\r\n            )\r\n          }\r\n          {\r\n            randomList.map((value, index) => (\r\n              <PuzzleItem \r\n                i={value.index}\r\n                key={index}\r\n                image={value.base64}\r\n                size={itemWidth}\r\n                left={value.left}\r\n                top={value.top}\r\n                index={index}\r\n                activeIndex={activeIndex}\r\n                clickEvent={this.puzzleItemClick} />\r\n              )\r\n            )\r\n          }\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import React, { Component } from 'react'\r\nimport Puzzle from \"./components/Puzzle/Puzzle\";\r\nimport Fireworks from \"./components/Fireworks/Fireworks\";\r\nimport OpeList from \"./components/OpeList/OpeList\";\r\nimport ToggleLevel from \"./components/ToggleLevel/ToggleLevel\";\r\nimport Back from \"components/Back/Back\";\r\nimport \"./GamePage.less\"\r\n\r\nexport default class GamePage extends Component {\r\n  state = {\r\n    end: false\r\n  }\r\n\r\n  componentDidMount() {\r\n    setTimeout(() => {\r\n      this.setState({\r\n        end: true\r\n      })\r\n    }, 100);\r\n  }\r\n\r\n  render() {\r\n    const {end} = this.state\r\n    return (\r\n      <div id='GamePage'>\r\n        <div className='bgImageContainer'>\r\n          <img src={require('assets/images/bg.jpg')} alt=\"\" />\r\n        </div>\r\n        <div className='logoContainer'>\r\n          <img src={require('assets/images/logo.png')} alt=\"\" />\r\n        </div>\r\n        <Back />\r\n        <Puzzle />\r\n        <OpeList />\r\n        <ToggleLevel />\r\n        <Fireworks />\r\n      </div>\r\n    )\r\n  }\r\n}"],"names":["token1","token2","token3","token4","Puzzle","state","isLoad","imageUrl","mode","imageList","randomList","itemWidth","gap","containWidth","activeIndex","computedCanvas","image","size","tempList","width","k","j","i","canvas","document","createElement","ctx","getContext","height","style","drawImage","push","computedAxis","index","base64","toDataURL","setState","getImageUrl","getRandomImage","then","res","replace","Image","src","crossOrigin","onload","temp","sort","item","Math","random","length","Object","assign","left","top","propertyName_x","propertyName_y","floor","puzzleItemClick","e","JSON","parse","stringify","e_left","e_top","checkPuzzle","arr","x","y","PubSub","documentElement","clientWidth","this","download","msg","id","className","map","value","PuzzleItem","clickEvent","Component","GamePage","end","setTimeout","require","alt","Back","OpeList","ToggleLevel","Fireworks"],"sourceRoot":""}