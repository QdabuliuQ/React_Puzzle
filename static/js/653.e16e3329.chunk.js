"use strict";(self.webpackChunkq_puzzle_q=self.webpackChunkq_puzzle_q||[]).push([[653],{8913:function(t,e,a){a.r(e),a.d(e,{default:function(){return w}});var i,s,n,o,d=a(5671),r=a(3144),c=a(136),m=a(7277),u=a(2791),l=a(4942),h=a(2982),f=a(1413),p=a(2597),v=a(3538),g=a.n(v),x=a(9205),b=a(6529),I=a(1895),L=a(184),W=function(t){(0,c.Z)(a,t);var e=(0,m.Z)(a);function a(){var t;(0,d.Z)(this,a);for(var i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(t=e.call.apply(e,[this].concat(s))).state={isLoad:!0,imageUrl:"",mode:3,imageList:[],randomList:[],itemWidth:0,gap:5,containWidth:0,activeIndex:-1},t.computedCanvas=function(e,a){for(var i=[],s=a/t.state.mode,n=1,o=0;o<t.state.mode;o++)for(var d=0;d<t.state.mode;d++){var r=document.createElement("canvas"),c=r.getContext("2d");r.width=s,r.height=s,r.style.width="100%",c.drawImage(e,d*s,o*s,s,s,0,0,s,s),i.push((0,f.Z)((0,f.Z)({},t.computedAxis(n-1,"x","y")),{},{index:n,base64:r.toDataURL("image/png")})),n++}t.setState({imageList:i},(function(){t.randomList()}))},t.getImageUrl=function(){(0,b.O)().then((function(e){t.state.imageUrl=e.replace("https://tuapi.eees.cc","/api1");var a=new Image;a.src=t.state.imageUrl,a.crossOrigin="",a.onload=function(){var e=a.width>a.height?a.height:a.width;t.computedCanvas(a,e)}}))},t.randomList=function(){var e=(0,h.Z)(t.state.imageList);e.sort((function(t){return Math.random()-.5}));for(var a=0;a<e.length;a++)e[a]=Object.assign(e[a],t.computedAxis(a));t.setState({randomList:e,isLoad:!1})},t.computedAxis=function(e){var a,i,s,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"left",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"top";return 0==e?(i=e%t.state.mode*t.state.itemWidth+"px",s=Math.floor(e/t.state.mode)*t.state.itemWidth+"px"):0!=e&&e<t.state.mode?(i=e%t.state.mode*t.state.itemWidth+t.state.gap*(e%t.state.mode)+"px",s=Math.floor(e/t.state.mode)*t.state.itemWidth+"px"):e%t.state.mode==0?(i=e%t.state.mode*t.state.itemWidth+"px",s=Math.floor(e/t.state.mode)*t.state.itemWidth+t.state.gap*Math.floor(e/t.state.mode)+"px"):(i=e%t.state.mode*t.state.itemWidth+t.state.gap*(e%t.state.mode)+"px",s=Math.floor(e/t.state.mode)*t.state.itemWidth+t.state.gap*Math.floor(e/t.state.mode)+"px"),a={},(0,l.Z)(a,n,i),(0,l.Z)(a,o,s),a},t.puzzleItemClick=function(e){if(e==t.state.activeIndex)t.setState({activeIndex:-1});else if(-1==t.state.activeIndex)t.setState({activeIndex:e});else{var a=JSON.parse(JSON.stringify(t.state.randomList)),i=a[e].left,s=a[e].top;a[e].left=a[t.state.activeIndex].left,a[e].top=a[t.state.activeIndex].top,a[t.state.activeIndex].left=i,a[t.state.activeIndex].top=s,t.setState({activeIndex:-1,randomList:a}),t.checkPuzzle(a)}},t.checkPuzzle=function(t){for(var e=1;e<t.length;e++)if(t[e].left!=t[e].x||t[e].top!=t[e].y)return;g().publish("success")},t}return(0,r.Z)(a,[{key:"componentDidMount",value:function(){var t=this,e=(document.documentElement.clientWidth-30)/this.state.mode;this.setState({itemWidth:e,containWidth:e*this.state.mode+(this.state.mode-1)*this.state.gap}),this.getImageUrl(),i=g().subscribe("replace",(function(){t.setState({isLoad:!0},(function(){t.getImageUrl()}))})),s=g().subscribe("save",(function(){(0,x.Z)(t.state.imageUrl,"image")})),n=g().subscribe("rank",(function(){t.setState({isLoad:!0},(function(){t.randomList()}))})),o=g().subscribe("modeChange",(function(e,a){t.setState({isLoad:!0,itemWidth:(t.state.containWidth-(a-1)*t.state.gap)/a,mode:a},(function(){var e=new Image;e.src=t.state.imageUrl,e.crossOrigin="",e.onload=function(){var a=e.width>e.height?e.height:e.width;t.computedCanvas(e,a)}}))}))}},{key:"componentWillUnmount",value:function(){g().unsubscribe(i),g().unsubscribe(s),g().unsubscribe(n),g().unsubscribe(o)}},{key:"render",value:function(){var t=this,e=this.state,a=e.isLoad,i=e.randomList,s=e.itemWidth,n=e.containWidth,o=e.activeIndex;e.imageList;return(0,L.jsx)("div",{id:"Puzzle",children:(0,L.jsxs)("div",{style:{width:n+"px"},className:"puzzleContainer",children:[a&&(0,L.jsx)("div",{className:"loadMask",children:(0,L.jsx)(p.wW,{style:{"--color":"#eaad30","--size":"100px"}})}),i.map((function(e,a){return(0,L.jsx)(I.Z,{i:e.index,image:e.base64,size:s,left:e.left,top:e.top,index:a,activeIndex:o,clickEvent:t.puzzleItemClick},a)}))]})})}}]),a}(u.Component),Z=a(8676),z=a(6788),j=a(7405),k=a(8698),w=function(t){(0,c.Z)(i,t);var e=(0,m.Z)(i);function i(){var t;(0,d.Z)(this,i);for(var a=arguments.length,s=new Array(a),n=0;n<a;n++)s[n]=arguments[n];return(t=e.call.apply(e,[this].concat(s))).state={end:!1},t}return(0,r.Z)(i,[{key:"componentDidMount",value:function(){var t=this;setTimeout((function(){t.setState({end:!0})}),100)}},{key:"render",value:function(){this.state.end;return(0,L.jsxs)("div",{id:"GamePage",children:[(0,L.jsx)("div",{className:"bgImageContainer",children:(0,L.jsx)("img",{src:a(8496),alt:""})}),(0,L.jsx)("div",{className:"logoContainer",children:(0,L.jsx)("img",{src:a(4427),alt:""})}),(0,L.jsx)(k.Z,{}),(0,L.jsx)(W,{}),(0,L.jsx)(z.Z,{}),(0,L.jsx)(j.Z,{}),(0,L.jsx)(Z.Z,{})]})}}]),i}(u.Component)}}]);
//# sourceMappingURL=653.e16e3329.chunk.js.map